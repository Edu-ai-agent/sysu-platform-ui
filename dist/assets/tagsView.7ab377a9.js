import{d as Da,c as X,u as Sa,j as Ta,o as G,e as d,H as Aa,S as V,E as Ia,g as _a,I as Z,_ as Pa,__tla as Ua}from"./index.5cfbf42e.js";import{M as aa,aC as $a,r as D,az as ea,aD as Oa,aH as Ea,a3 as ja,l as U,K as Ma,I as Ha,al as Wa,k as Fa,aJ as za,i as Ka,ak as ta,o as y,a as L,$,V as Ya,b as ia,P as O,u as p,F as sa,ac as Ba,a8 as b,Y as C,U as E,_ as Ja,n as j}from"./vue.86fe07f1.js";import{S as Na}from"./sortable.esm.9c3c89c5.js";let ra,Qa=Promise.all([(()=>{try{return Ua}catch{}})()]).then(async()=>{const la=["data-url","onContextmenu","onMousedown","onClick"],na={key:0,class:"iconfont icon-webicon318 layout-navbars-tagsview-ul-li-iconfont"},ua=aa({name:"layoutTagsView"}),oa=aa({...ua,setup(Xa){const ma=$a(()=>Da(()=>import("./contextmenu.d1f6a1fa.js").then(async e=>(await e.__tla,e)),["assets/contextmenu.d1f6a1fa.js","assets/vue.86fe07f1.js","assets/index.5cfbf42e.js","assets/index.192907a2.css","assets/contextmenu.1b050f60.css"])),h=D([]),k=D(),M=D(),ca=D(),ha=X(),pa=Sa(),H=X(),{themeConfig:W}=ea(pa),{tagsViewRoutes:wa,favoriteRoutes:ga}=ea(H),f=Ta(),c=Oa(),o=Ea(),i=ja({routeActive:"",routePath:c.path,dropdown:{x:"",y:""},sortable:"",tagsRefsIndex:0,tagsViewList:[],tagsViewRoutesList:[]}),fa=U(()=>W.value.tagsStyle),u=U(()=>W.value),ya=U(()=>e=>G.setMenuI18n(e)),q=e=>u.value.isShareTagsView?e.path===i.routePath:e.query&&Object.keys(e.query).length||e.params&&Object.keys(e.params).length?e.url?e.url===i.routeActive:e.path===i.routeActive:e.path===i.routePath,w=e=>{V.set("tagsViewList",e)},F=async()=>{i.routeActive=await g(c),i.routePath=await c.meta.isDynamic?c.meta.isDynamicPath:c.path,i.tagsViewList=[],i.tagsViewRoutesList=wa.value,da()},da=async()=>{V.get("tagsViewList")&&u.value.isCacheTagsView?i.tagsViewList=await V.get("tagsViewList"):(await i.tagsViewRoutesList.map(e=>{var a;(a=e.meta)!=null&&a.isAffix&&!e.meta.isHide&&(e.url=g(e),i.tagsViewList.push({...e}),f.addCachedView(e))}),await S(c.path,c)),J(u.value.isShareTagsView?i.routePath:i.routeActive)},z=async(e,a)=>{var r,s;let t=(r=a==null?void 0:a.meta)!=null&&r.isDynamic?a.meta.isDynamicPath:e;if(i.tagsViewList.filter(l=>{var n,m;return l.path===t&&Z((n=a==null?void 0:a.meta)!=null&&n.isDynamic?l.params?l.params:null:l.query?l.query:null,(m=a==null?void 0:a.meta)!=null&&m.isDynamic?a!=null&&a.params?a==null?void 0:a.params:null:a!=null&&a.query?a==null?void 0:a.query:null)}).length<=0){let l=i.tagsViewRoutesList.find(n=>n.path===t);if(!l||l.meta.isAffix||l.meta.isLink&&!l.meta.isIframe)return!1;(s=a==null?void 0:a.meta)!=null&&s.isDynamic?l.params=a.params:l.query=a==null?void 0:a.query,l.url=g(l),i.tagsViewList.push({...l}),await f.addCachedView(l),w(i.tagsViewList)}},K=(e,a)=>{var r;let t=(r=a==null?void 0:a.meta)!=null&&r.isDynamic?a.meta.isDynamicPath:e;i.tagsViewList.forEach(s=>{var l,n,m;s.path===t&&!Z((l=a==null?void 0:a.meta)!=null&&l.isDynamic?s.params?s.params:null:s.query?s.query:null,(n=a==null?void 0:a.meta)!=null&&n.isDynamic?a!=null&&a.params?a==null?void 0:a.params:null:a!=null&&a.query?a==null?void 0:a.query:null)&&((m=a==null?void 0:a.meta)!=null&&m.isDynamic?s.params=a.params:s.query=a==null?void 0:a.query,s.url=g(s),w(i.tagsViewList))})},S=(e,a)=>{j(async()=>{var r,s,l;let t;if((r=a==null?void 0:a.meta)!=null&&r.isDynamic){if(u.value.isShareTagsView?await K(e,a):await z(e,a),i.tagsViewList.some(n=>{var m;return n.path===((m=a==null?void 0:a.meta)==null?void 0:m.isDynamicPath)}))return w(i.tagsViewList),!1;t=i.tagsViewRoutesList.find(n=>{var m;return n.path===((m=a==null?void 0:a.meta)==null?void 0:m.isDynamicPath)})}else{if(u.value.isShareTagsView?await K(e,a):await z(e,a),i.tagsViewList.some(n=>n.path===e))return w(i.tagsViewList),!1;t=i.tagsViewRoutesList.find(n=>n.path===e)}if(!t||(s=t==null?void 0:t.meta)!=null&&s.isLink&&!t.meta.isIframe)return!1;(l=a==null?void 0:a.meta)!=null&&l.isDynamic?t.params=a!=null&&a.params?a==null?void 0:a.params:c.params:t.query=a!=null&&a.query?a==null?void 0:a.query:c.query,t.url=g(t),await f.addCachedView(t),await i.tagsViewList.push({...t}),await w(i.tagsViewList)})},Y=async e=>{var r;const a=decodeURI(e);let t={};if(i.tagsViewList.forEach(s=>{s.transUrl=v(s),s.transUrl?s.transUrl===v(s)&&(t=s):s.path===a&&(t=s)}),!t)return!1;await f.delCachedView(t),d.emit("onTagsViewRefreshRouterView",e),(r=t.meta)!=null&&r.isKeepAlive&&f.addCachedView(t)},T=e=>{i.tagsViewList.map((a,t,r)=>{var s;(s=a.meta)!=null&&s.isAffix||(u.value.isShareTagsView?a.path===e:a.url===e)&&(f.delCachedView(a),i.tagsViewList.splice(t,1),setTimeout(()=>{(i.tagsViewList.length===t&&u.value.isShareTagsView?i.routePath===e:i.routeActive===e)?r[r.length-1].meta.isDynamic?t!==r.length?o.push({name:r[t].name,params:r[t].params}):o.push({name:r[r.length-1].name,params:r[r.length-1].params}):t!==r.length?o.push({path:r[t].path,query:r[t].query}):o.push({path:r[r.length-1].path,query:r[r.length-1].query}):(i.tagsViewList.length!==t&&u.value.isShareTagsView?i.routePath===e:i.routeActive===e)&&(r[t].meta.isDynamic?o.push({name:r[t].name,params:r[t].params}):o.push({path:r[t].path,query:r[t].query}))},0))}),w(i.tagsViewList)},Va=e=>{V.get("tagsViewList")&&(i.tagsViewList=[],V.get("tagsViewList").map(a=>{var t;(t=a.meta)!=null&&t.isAffix&&!a.meta.isHide&&(a.url=g(a),f.delOthersCachedViews(a),i.tagsViewList.push({...a}))}),S(e,c),w(i.tagsViewList))},va=()=>{V.get("tagsViewList")&&(f.delAllCachedViews(),i.tagsViewList=[],V.get("tagsViewList").map(e=>{var a;(a=e.meta)!=null&&a.isAffix&&!e.meta.isHide&&(e.url=g(e),i.tagsViewList.push({...e}),o.push({path:i.tagsViewList[i.tagsViewList.length-1].path}))}),w(i.tagsViewList))},La=async e=>{const a=i.tagsViewList.find(t=>u.value.isShareTagsView?t.path===e:t.url===e);a.meta.isDynamic?await o.push({name:a.name,params:a.params}):await o.push({name:a.name,query:a.query}),ha.setCurrenFullscreen(!0)},B=e=>{let a={};return i.tagsViewList.forEach(t=>{t.transUrl=v(t),t.transUrl?t.transUrl===v(t)&&t.transUrl===e.commonUrl&&(a=t):t.path===decodeURI(e.path)&&(a=t)}),a||null},A=async e=>{if(e.commonUrl=v(e),!B(e))return Ia({type:"warning",message:"\u8BF7\u6B63\u786E\u8F93\u5165\u8DEF\u5F84\u53CA\u5B8C\u6574\u53C2\u6570\uFF08query\u3001params\uFF09"});const{path:a,name:t,params:r,query:s,meta:l,url:n}=B(e);switch(e.contextMenuClickId){case 0:l.isDynamic?await o.push({name:t,params:r}):await o.push({path:a,query:s}),Y(c.fullPath);break;case 1:T(u.value.isShareTagsView?a:n);break;case 2:l.isDynamic?await o.push({name:t,params:r}):await o.push({path:a,query:s}),Va(a);break;case 3:va();break;case 4:La(u.value.isShareTagsView?a:n);break;case 5:ba(e);break}},ba=e=>{ga.value.find(a=>a.path===e.path)?_a().error("\u5DF2\u7ECF\u5B58\u5728\u6536\u85CF"):H.setFavoriteRoutes(e)},Ca=(e,a)=>{const{clientX:t,clientY:r}=a;i.dropdown.x=t,i.dropdown.y=r,M.value.openContextmenu(e)},ka=(e,a)=>{var t;if(!((t=e.meta)!=null&&t.isAffix)&&a.button===1){const r=Object.assign({},{contextMenuClickId:1,...e});A(r)}},qa=(e,a)=>{i.tagsRefsIndex=a,o.push(e)},v=e=>{var r,s;let a=e.query&&Object.keys(e.query).length>0?e.query:e.params;if(!a)return"";let t="";for(let[l,n]of Object.entries(a))(r=e.meta)!=null&&r.isDynamic?t+=`/${n}`:t+=`&${l}=${n}`;return(s=e.meta)!=null&&s.isDynamic?e.isFnClick?decodeURI(e.path):`${e.path.split(":")[0]}${t.replace(/^\//,"")}`:`${e.path}${t.replace(/^&/,"?")}`},g=e=>{var r;let a=e.query&&Object.keys(e.query).length>0?e.query:e.params;if(!a||Object.keys(a).length<=0)return e.path;let t="";for(let s in a)t+=a[s];return`${(r=e.meta)!=null&&r.isDynamic?e.meta.isDynamicPath:e.path}-${t}`},Ra=e=>{k.value.$refs.wrapRef.scrollLeft+=e.wheelDelta/4},xa=()=>{j(()=>{if(h.value.length<=0)return!1;let e=h.value[i.tagsRefsIndex],a=i.tagsRefsIndex,t=h.value.length,r=h.value[0],s=h.value[h.value.length-1],l=k.value.$refs.wrapRef,n=l.scrollWidth,m=l.offsetWidth,N=l.scrollLeft,P=h.value[i.tagsRefsIndex-1],Q=h.value[i.tagsRefsIndex+1],R=0,x=0;e===r?l.scrollLeft=0:e===s?l.scrollLeft=n-m:(a===0?R=r.offsetLeft-5:R=(P==null?void 0:P.offsetLeft)-5,a===t?x=s.offsetLeft+s.offsetWidth+5:x=Q.offsetLeft+Q.offsetWidth+5,x>N+m?l.scrollLeft=x-m:R<N&&(l.scrollLeft=R)),k.value.update()})},J=e=>{j(async()=>{let a=await i.tagsViewList;i.tagsRefsIndex=a.findIndex(t=>u.value.isShareTagsView?t.path===e:t.url===e),xa()})},I=async()=>{const e=document.querySelector(".layout-navbars-tagsview-ul");if(!e)return!1;i.sortable.el&&i.sortable.destroy(),i.sortable=Na.create(e,{animation:300,dataIdAttr:"data-url",disabled:!u.value.isSortableTagsView,onEnd:()=>{const a=[];i.sortable.toArray().map(t=>{i.tagsViewList.map(r=>{r.url===t&&a.push({...r})})}),w(a)}})},_=async()=>{await I(),G.isMobile()&&i.sortable.el&&i.sortable.destroy()};return Ma(()=>{_(),window.addEventListener("resize",_),d.on("onCurrentContextmenuClick",e=>{e.isFnClick=!0,A(e)}),d.on("openOrCloseSortable",()=>{I()}),d.on("openShareTagsView",()=>{u.value.isShareTagsView&&(o.push("/home/index"),i.tagsViewList=[],i.tagsViewRoutesList.map(e=>{var a;(a=e.meta)!=null&&a.isAffix&&!e.meta.isHide&&(e.url=g(e),i.tagsViewList.push({...e}))}))})}),Ha(()=>{d.off("onCurrentContextmenuClick",()=>{}),d.off("openOrCloseSortable",()=>{}),d.off("openShareTagsView",()=>{}),window.removeEventListener("resize",_)}),Wa(()=>{h.value=[]}),Fa(()=>{F(),I()}),za(async e=>{i.routeActive=g(e),i.routePath=e.meta.isDynamic?e.meta.isDynamicPath:e.path,await S(e.path,e),J(u.value.isShareTagsView?i.routePath:i.routeActive)}),Ka(Aa.state,e=>{if(e.tagsViewRoutes.tagsViewRoutes.length===i.tagsViewRoutesList.length)return!1;F()},{deep:!0}),(e,a)=>{const t=ta("SvgIcon"),r=ta("el-scrollbar");return y(),L("div",{class:O(["layout-navbars-tagsview",{"layout-navbars-tagsview-shadow":p(u).layout==="classic"}])},[$(r,{ref_key:"scrollbarRef",ref:k,onWheel:b(Ra,["prevent"])},{default:Ya(()=>[ia("ul",{class:O(["layout-navbars-tagsview-ul",p(fa)]),ref_key:"tagsUlRef",ref:ca},[(y(!0),L(sa,null,Ba(p(i).tagsViewList,(s,l)=>(y(),L("li",{key:l,class:O(["layout-navbars-tagsview-ul-li",{"is-active":q(s)}]),"data-url":s.url,onContextmenu:b(n=>Ca(s,n),["prevent"]),onMousedown:n=>ka(s,n),onClick:n=>qa(s,l),ref_for:!0,ref:n=>{n&&(p(h)[l]=n)}},[q(s)?(y(),L("i",na)):C("",!0),!q(s)&&p(u).isTagsviewIcon?(y(),E(t,{key:1,name:s.meta.icon,class:"pr5"},null,8,["name"])):C("",!0),ia("span",null,Ja(p(ya)(s)),1),q(s)?(y(),L(sa,{key:2},[$(t,{name:"ele-RefreshRight",class:"ml5 layout-navbars-tagsview-ul-li-refresh",onClick:a[0]||(a[0]=b(n=>Y(e.$route.fullPath),["stop"]))}),s.meta.isAffix?C("",!0):(y(),E(t,{key:0,name:"ele-Close",class:"layout-navbars-tagsview-ul-li-icon layout-icon-active",onClick:b(n=>T(p(u).isShareTagsView?s.path:s.url),["stop"])},null,8,["onClick"]))],64)):C("",!0),s.meta.isAffix?C("",!0):(y(),E(t,{key:3,name:"ele-Close",class:"layout-navbars-tagsview-ul-li-icon layout-icon-three",onClick:b(n=>T(p(u).isShareTagsView?s.path:s.url),["stop"])},null,8,["onClick"]))],42,la))),128))],2)]),_:1},8,["onWheel"]),$(p(ma),{dropdown:p(i).dropdown,ref_key:"contextmenuRef",ref:M,onCurrentContextmenuClick:A},null,8,["dropdown"])],2)}}});ra=Pa(oa,[["__scopeId","data-v-b049ac92"]])});export{Qa as __tla,ra as default};
